---
title: "個人開発で利用したソフトウェアやサービスとその選定理由"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["個人開発", "Django", "SQLite3", "sish", "VPS"]
published: false
---


## 概要
先日 [TCP Exposer](https://www.tcpexposer.com/) という、プライベートIPアドレスしか持たないローカルサーバーに、インターネットからアクセスできるようにするサービスを作りました。
本記事ではTCP Exposerを開発・運用する際に利用したソフトウェアやサービスを紹介します。

使い方や開発理由ついては[以前投稿したZennの記事](https://zenn.dev/teasy/articles/tcpexposer-intoroduction)に記載しています。
ご興味が出たら、こちらもチェックしてみてください。


<!-- ---------------------------------------------------------------------- -->


## 開発に利用したソフトウェア

TCP Exposerは以下のソフトウェアを使って開発しました。

- [sish](https://github.com/antoniomika/sish)
- [Django](https://docs.djangoproject.com/ja/4.0/)
- [SQLite](https://www.sqlite.org/index.html)


<!-- ---------------------------------------------------------------------- -->


### sish

TCP Exposerの核となる機能を提供しているソフトウェアです。
ローカルサーバーのポートをインターネットに公開するソフトウェアはこれ以外にもあり、[このGitHubのリポジトリ](https://github.com/anderspitman/awesome-tunneling)によくまとまっています。

その中でsishを選んだ理由は、ユーザーの利便性や使用開始時のハードルを下げるためです。
sishの場合は専用のクライアントソフトをローカルサーバーにインストールする必要がなく、OSに標準でインストールされているSSHクライアントを使います。
ユーザーにとって自分のPCにソフトをインストールするのは面倒であったり、セキュリティ的に不安であったりするかと思い、sishを選択しました。

TCP Exposerはsishをそのまま利用しているわけでありません。
私が確認したタイミングでは、sishは不特定多数のユーザーというよりも信用できる限られたユーザーを対象としたソフトウェアのようで、なりすましを防ぐのが難しい作りになっていました。
そのため、ユーザー認証周りを一部変更しているのと、認証情報をDBから読み込むようにソースコードを変更しました。


<!-- ---------------------------------------------------------------------- -->


### Django

#### 選定理由
サービスのトップページや、ユーザー登録関連でDjangoを使いました。
Djangoを使った理由は、PythonのフルスタックWEBフレームワークであるからです。
私はプログラミング言語の中ではPythonが一番得意だったため、PythonのWEBフレームワークの中で探しました。
また、サービスの特性上、ユーザー認証機能やDB連携機能が必須でした。
Flaskのようなマイクロフレームワークも検討しましたが、認証やDBの機能を使うためにはプラグインが必要なため、そのプラグインの選定しなければならず、選定するのが面倒でした。
そういった理由からPythonのフルスタックWEBフレームワークの中でおそらく圧倒的な人気を持つDjangoを選びました。


#### 使用した感想
Djangoを選定したことに後悔はありませんが、使っていく中で下記のような不満がありました。

- 型ヒントが活用しにくい
- フロントエンドの開発がしにくい

私はPythonの型ヒントを多用しますが、Djangoでは型ヒントが使えない場合が多かったです。
Django関連の変数やクラスなどに型ヒントの警告が多数出たり、またそれを抑えるためのコメントも増えたり、エディタの補完機能も使えなかったりで開発しにくかったです。
なお、他のPythonフレームワークと比較したわけではなく、自分で書いたコードと比較した際の感想です。
また、フレームワークとしての汎用性を持たせつつ、型を定義することは難しいとは思っており、今後改善されると嬉しいです。

フロントエンドの開発もしにくかったです。
今回はDjangoのチュートリアルにもあるテンプレートエンジンを使ってフロントエンドの開発をしました。
ReactではHTMLとCSSの知識があれば雰囲気で開発できることが多かったのですが、Djangoは特有の知識を求められることが多い印象を受けました。
例えば、ユーザーが入力したデータをサーバーに送るときなど、入力値が不正な場合にメッセージを表示する際などです。
また、先程の例ではDjangoのフォームという機能を使うのがDjango的には推奨されているのですが、一つのページに複数のフォームを設けたい場合や、結果を同じURLで表示したい場合など、少し応用的なことがしたい場合に手が止まることが多かったです。


<!-- ---------------------------------------------------------------------- -->


### SQLite

DBにはSQLiteを使っています。
DBへのアクセスは、Djangoで開発したWEBアプリからは読み書きを、sishからは読み込みをしています。

SQLiteを選んだ理由は軽量なDBだからです。
個人開発で宣伝も大してできないことからユーザ数は少なく(悲しいことにこの予想は当たりました)、サービスの特性上一人のユーザーがDBアクセスが必要な操作を頻繁にしないことが予想されました。
そのため、軽量と言われており、データの実態がファイル一つで管理できるSQLiteを選びました。


<!-- ---------------------------------------------------------------------- -->


## 運用時に利用しているサービス

### デプロイ環境

[KAGOYA CLOUD VPS](https://www.kagoya.jp/cloud/vps/price/)という日本企業のVPSサービスを使っています。
VPSはクラウド上にあるLinuxサーバーのようなものです。
HerokuなどのPaaSはHTTP(S)でのアクセスしかできず(間違っていたらすみません)、SSHが必要な今回のサービスでは利用できませんでした。
AWSのEC2など大手クラウドの仮想マシンサービスや他のVPSサービスも考えたのですが、以下の理由からKAGOYA CLOUD VPSを選びました。

- 日本語対応なこと
- 類似のサービスに比べてマシンスペックの割に安いこと
- 通信量に応じた費用がかからず料金が一定であること
- 自動スケールアウトなど高度な使い方をする予定がないこと

特に使いにくいことはなく不満はありません。
しかし、現状ユーザが少ないことから、アクセスも少なく通信データ量も少なく、通信量は気にする必要はありませんでした。
また、そのような状況なので運用費を抑えたい気持ちが出てきており、Oracle Cloudの無料のARM仮想マシンが気になっています。


<!-- ---------------------------------------------------------------------- -->


### ドメイン管理

ドメイン関係では以下のサービスを利用しています。

- [お名前ドットコム](https://www.onamae.com/)
- [Cloudflare](https://www.cloudflare.com/ja-jp/)
- [Let's Encrypt](https://letsencrypt.org/ja/)
- [Certbot](https://letsencrypt.org/ja/docs/client-options/)


#### お名前ドットコム
ドメインはお名前ドットコムで購入しました。
それらしいキーワードで検索したらトップだったのと、登録料が1円だったからです。
なお、後から分かったのですが、1円なのは初回だけで2つ目以降のドメイン登録は、キャンペーンの有無で変わりますが1000円程度かかりますのでご注意ください。
また、継続利用するには1年ごとに更新する必要があるのですが、その場合も1000円程度かかりそうです。


#### Cloudflare
ドメインのネームサーバーにはCloudflareを使っています。
お名前ドットコムのままではCertbotというツールによるワイルドカードSSL証明書の自動更新ができなかったためです。
そのため、ドメインのレジストラはお名前ドットコムで、ネームサーバーはCloudflareという変則的な形になっています。
狙ってやったわけでなく、後から必要にかられてこのような構成になりました。


#### Let's Encrypt
パスワード等の秘密情報を扱うので、HTTP(S)通信が必要になります。
そのため、SSL証明書を発行する必要がありました。
こちらはLet's Encryptという無料で証明書を発行できるサービスを利用しました。
少し調べただけですが、無料でSSL証明書を発行したい場合は、このサービス一択になりそうです。
また、無料で発行できますが、3ヶ月ごとに更新する必要があります。

サブドメインをユーザーに貸し出すというサービスの特性上、証明書はワイルドカード証明書という自分の管理するドメインに対する任意のサブドメインに対する証明書が必要です。
TCP Exposerの場合、foo.tcpexposer.comのようなドメインで、foo以外にもいろいろなサブドメインに対してHTTPS通信できる必要があります。
Let's Encryptでもワイルドカード証明書の発行はできます。


#### Certbot
証明書は定期的に更新する必要があるため、自動化に向いている作業です。
Let's Encryptが推奨しているCertbotというツールを定期的に実行することで、自動更新することができます。

ワイルドカード証明書の場合は、通常のSSL証明書よりも取得や更新が面倒で、ネームサーバーに対していろいろする必要があります。
このあたりの自動化のために、CloudflareのようないくつかのDNSサービスはCertbot用の[プラグイン](https://eff-certbot.readthedocs.io/en/stable/using.html#dns-plugins)を提供しています。
お名前ドットコムのCertbotプラグインは無さそうだったので、プラグインがあるDNSで聞いたことがあるCloudflareを利用しています。


<!-- ---------------------------------------------------------------------- -->


## 最後に

[TCP Exposer](https://www.tcpexposer.com/)というサービスを開発・運用する際に利用したソフトウェアやサービスを紹介しました。
皆さんの開発時の技術選定やモチベーション維持に役立ってくれることを願っています。
また、サービスの使い方や開発理由ついて興味がある方は[以前投稿したZennの記事](https://zenn.dev/teasy/articles/tcpexposer-intoroduction)をチェックしてみてください。
